
rule feature_count:
    """Assigns counts to annotated features using name sorted BAMs."""
    input: bams = expand("results/mapping/{{reference}}/{{kind}}/{unit}_name.bam", unit = config["units"].keys() ) ,
           gtf = lambda wildcards: config["ref_dir"] + config["features"][wildcards.features]
    output: "results/de/{reference}/{kind}/{features}.counts"
    threads: 20
    params: feature = config["features"]["type"]
    shell: "/usr/local/bin/subread-1.4.6/bin/featureCounts -T {threads} -p -t exon -g {params.feature} -a {input.gtf} -o {output} {input.bams}"
    
